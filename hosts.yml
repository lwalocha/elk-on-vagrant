- hosts: all
  tasks:
    - name: "Build hosts file"
      lineinfile: dest=/etc/hosts regexp='.*{{ item }}$' line="{{ hostvars[item]['ansible_host'] }} {{item}}" state=present
      when: hostvars[item]['ansible_host'] is defined
      with_items: '{{ groups["all"] }}'
      sudo: yes
    - name: add entry to hosts file
      lineinfile:
        path: /etc/hosts
        line: '{{masterHost_ip}} {{el_instance_name}}'
      sudo: yes

